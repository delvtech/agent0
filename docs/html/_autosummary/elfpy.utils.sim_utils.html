
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>elfpy.utils.sim_utils &#8212; elfpy v0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="elfpy.utils.sim_utils.get_init_lp_agent" href="elfpy.utils.sim_utils.get_init_lp_agent.html" />
    <link rel="prev" title="elfpy.utils.price.calc_spot_price_from_apr" href="elfpy.utils.price.calc_spot_price_from_apr.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-elfpy.utils.sim_utils">
<span id="elfpy-utils-sim-utils"></span><h1>elfpy.utils.sim_utils<a class="headerlink" href="#module-elfpy.utils.sim_utils" title="Permalink to this heading">¶</a></h1>
<p>Implements helper functions for setting up a simulation</p>
<p class="rubric">Functions</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="elfpy.utils.sim_utils.get_init_lp_agent.html#elfpy.utils.sim_utils.get_init_lp_agent" title="elfpy.utils.sim_utils.get_init_lp_agent"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_init_lp_agent</span></code></a>(market, target_liquidity, ...)</p></td>
<td><p>Calculate the required deposit amounts and instantiate the LP agent</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="elfpy.utils.sim_utils.get_market.html#elfpy.utils.sim_utils.get_market" title="elfpy.utils.sim_utils.get_market"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_market</span></code></a>(pricing_model, target_pool_apr, ...)</p></td>
<td><p>Setup market</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="elfpy.utils.sim_utils.get_pricing_model.html#elfpy.utils.sim_utils.get_pricing_model" title="elfpy.utils.sim_utils.get_pricing_model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_pricing_model</span></code></a>(model_name)</p></td>
<td><p>Get a PricingModel object from the config passed in</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="elfpy.utils.sim_utils.get_simulator.html#elfpy.utils.sim_utils.get_simulator" title="elfpy.utils.sim_utils.get_simulator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_simulator</span></code></a>(config[, agents, random_sim_vars])</p></td>
<td><p>Constructs a simulator with sane defaults and initializes the simulator with an initial LP.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="elfpy.utils.sim_utils.override_random_variables.html#elfpy.utils.sim_utils.override_random_variables" title="elfpy.utils.sim_utils.override_random_variables"><code class="xref py py-obj docutils literal notranslate"><span class="pre">override_random_variables</span></code></a>(random_variables, ...)</p></td>
<td><p>Override the random simulation variables with targeted values, as specified by the keys</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="elfpy.utils.sim_utils.get_simulator">
<span class="sig-prename descclassname"><span class="pre">elfpy.utils.sim_utils.</span></span><span class="sig-name descname"><span class="pre">get_simulator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">agents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_sim_vars</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#elfpy.utils.sim_utils.get_simulator" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs a simulator with sane defaults and initializes the simulator
with an initial LP.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> (<a class="reference internal" href="elfpy.utils.config.Config.html#elfpy.utils.config.Config" title="elfpy.utils.config.Config"><em>Config</em></a>) – the simulator config</p></li>
<li><p><strong>agents</strong> (<em>list</em><em>[</em><a class="reference internal" href="../api.html#elfpy.agent.Agent" title="elfpy.agent.Agent"><em>Agent</em></a><em>]</em>) – the agents to that should be used in the simulator</p></li>
<li><p><strong>random_sim_vars</strong> (<a class="reference internal" href="../api.html#elfpy.types.RandomSimulationVariables" title="elfpy.types.RandomSimulationVariables"><em>RandomSimulationVariables</em></a>) – dataclass that contains variables for initiating and running simulations</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="../api.html#elfpy.simulators.Simulator" title="elfpy.simulators.Simulator"><code class="xref py py-class docutils literal notranslate"><span class="pre">elfpy.simulators.Simulator</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="elfpy.utils.sim_utils.get_init_lp_agent">
<span class="sig-prename descclassname"><span class="pre">elfpy.utils.sim_utils.</span></span><span class="sig-name descname"><span class="pre">get_init_lp_agent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">market</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_liquidity</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_pool_apr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fee_percent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed_liquidity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#elfpy.utils.sim_utils.get_init_lp_agent" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the required deposit amounts and instantiate the LP agent</p>
<p>The required deposit amounts are computed iteratively to determine market reserve levels that achieve
the target liquidity and APR. To hit the desired ratio, the agent opens a small LP, then a short,
then a larger LP. Each iteration estimates the slippage due to the short and adjusts the first LP amount
to account for it. The difference in slippage from one iteration to the next monotonically decreases,
since it is accounting for diminishing additions to the market share reserves. A more detailed description
is here: <a class="reference external" href="https://github.com/element-fi/elf-simulations/pull/136#issuecomment-1405922764">https://github.com/element-fi/elf-simulations/pull/136#issuecomment-1405922764</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>market</strong> (<a class="reference internal" href="../api.html#elfpy.markets.Market" title="elfpy.markets.Market"><em>Market</em></a>) – empty market object</p></li>
<li><p><strong>target_liquidity</strong> (<em>float</em>) – target total liquidity for LPer to provide (bonds+shares)
the result will be within 1e-15% of the target</p></li>
<li><p><strong>target_pool_apr</strong> (<em>float</em>) – target pool apr for the market
the result will be within 1e-13% of the target</p></li>
<li><p><strong>fee_percent</strong> (<em>float</em>) – how much the LPer will collect in fees</p></li>
<li><p><strong>seed_liquidity</strong> (<em>float</em>) – initial (small) liquidity amount for setting the market APR</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>init_lp_agent</strong> – Agent class that will perform the lp initialization action</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="../api.html#elfpy.agent.Agent" title="elfpy.agent.Agent">Agent</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="elfpy.utils.sim_utils.get_market">
<span class="sig-prename descclassname"><span class="pre">elfpy.utils.sim_utils.</span></span><span class="sig-name descname"><span class="pre">get_market</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pricing_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_pool_apr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fee_percent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position_duration</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vault_apr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_share_price</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#elfpy.utils.sim_utils.get_market" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup market</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pricing_model</strong> (<em>PricingModel</em>) – instantiated pricing model</p></li>
<li><p><strong>target_pool_apr</strong> (<em>float</em>) – target apr, used for calculating the time stretch
NOTE: the market apr will not have this target value until the init_lp agent trades,
or the share &amp; bond reserves are explicitly set</p></li>
<li><p><strong>fee_percent</strong> (<em>float</em>) – portion of outputs to be collected as fees for LPers, expressed as a decimal
TODO: Rename this variable so that it doesn’t use “percent”</p></li>
<li><p><strong>token_duration</strong> (<em>float</em>) – how much time between token minting and expiry, in fractions of a year (e.g. 0.5 is 6 months)</p></li>
<li><p><strong>vault_apr</strong> (<em>list</em>) – valut apr per day for the duration of the simulation</p></li>
<li><p><strong>init_share_price</strong> (<em>float</em>) – the initial price of the yield bearing vault shares</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>instantiated market without any liquidity (i.e. no shares or bonds)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="../api.html#elfpy.markets.Market" title="elfpy.markets.Market">Market</a></p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>position_duration</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – </p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="elfpy.utils.sim_utils.get_pricing_model">
<span class="sig-prename descclassname"><span class="pre">elfpy.utils.sim_utils.</span></span><span class="sig-name descname"><span class="pre">get_pricing_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#elfpy.utils.sim_utils.get_pricing_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a PricingModel object from the config passed in</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>model_name</strong> (<em>str</em>) – name of the desired pricing_model; can be “hyperdrive”, or “yieldspace”</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>instantiated pricing model matching the input argument</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>PricingModel</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="elfpy.utils.sim_utils.override_random_variables">
<span class="sig-prename descclassname"><span class="pre">elfpy.utils.sim_utils.</span></span><span class="sig-name descname"><span class="pre">override_random_variables</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">random_variables</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">override_dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#elfpy.utils.sim_utils.override_random_variables" title="Permalink to this definition">¶</a></dt>
<dd><p>Override the random simulation variables with targeted values, as specified by the keys</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>random_variables</strong> (<a class="reference internal" href="../api.html#elfpy.types.RandomSimulationVariables" title="elfpy.types.RandomSimulationVariables"><em>RandomSimulationVariables</em></a>) – dataclass that contains variables for initiating and running simulations</p></li>
<li><p><strong>override_dict</strong> (<em>dict</em>) – dictionary containing keys that correspond to member fields of the RandomSimulationVariables class</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>same dataclass as the random_variables input, but with fields specified by override_dict changed</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="../api.html#elfpy.types.RandomSimulationVariables" title="elfpy.types.RandomSimulationVariables">RandomSimulationVariables</a></p>
</dd>
</dl>
</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">elfpy</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="elfpy.html">elfpy</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="elfpy.agent.html">elfpy.agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="elfpy.markets.html">elfpy.markets</a></li>
<li class="toctree-l2"><a class="reference internal" href="elfpy.simulators.html">elfpy.simulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="elfpy.types.html">elfpy.types</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="elfpy.utils.html">elfpy.utils</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="elfpy.utils.config.html">elfpy.utils.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="elfpy.utils.outputs.html">elfpy.utils.outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="elfpy.utils.parse_config.html">elfpy.utils.parse_config</a></li>
<li class="toctree-l3"><a class="reference internal" href="elfpy.utils.post_processing.html">elfpy.utils.post_processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="elfpy.utils.price.html">elfpy.utils.price</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">elfpy.utils.sim_utils</a><ul>
<li class="toctree-l4"><a class="reference internal" href="elfpy.utils.sim_utils.get_init_lp_agent.html">elfpy.utils.sim_utils.get_init_lp_agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="elfpy.utils.sim_utils.get_market.html">elfpy.utils.sim_utils.get_market</a></li>
<li class="toctree-l4"><a class="reference internal" href="elfpy.utils.sim_utils.get_pricing_model.html">elfpy.utils.sim_utils.get_pricing_model</a></li>
<li class="toctree-l4"><a class="reference internal" href="elfpy.utils.sim_utils.get_simulator.html">elfpy.utils.sim_utils.get_simulator</a></li>
<li class="toctree-l4"><a class="reference internal" href="elfpy.utils.sim_utils.override_random_variables.html">elfpy.utils.sim_utils.override_random_variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#elfpy.utils.sim_utils.get_simulator"><code class="docutils literal notranslate"><span class="pre">get_simulator()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#elfpy.utils.sim_utils.get_init_lp_agent"><code class="docutils literal notranslate"><span class="pre">get_init_lp_agent()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#elfpy.utils.sim_utils.get_market"><code class="docutils literal notranslate"><span class="pre">get_market()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#elfpy.utils.sim_utils.get_pricing_model"><code class="docutils literal notranslate"><span class="pre">get_pricing_model()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#elfpy.utils.sim_utils.override_random_variables"><code class="docutils literal notranslate"><span class="pre">override_random_variables()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="elfpy.utils.time.html">elfpy.utils.time</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="elfpy.wallet.html">elfpy.wallet</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="elfpy.html">elfpy</a><ul>
  <li><a href="elfpy.utils.html">elfpy.utils</a><ul>
      <li>Previous: <a href="elfpy.utils.price.calc_spot_price_from_apr.html" title="previous chapter">elfpy.utils.price.calc_spot_price_from_apr</a></li>
      <li>Next: <a href="elfpy.utils.sim_utils.get_init_lp_agent.html" title="next chapter">elfpy.utils.sim_utils.get_init_lp_agent</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy; 2023, Element Finance.
      
      |
      <a href="../_sources/_autosummary/elfpy.utils.sim_utils.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>